## [M-01] Potential Risk Due to Fixed Healthy Difference in DataFeed Contract

### Summary

The `_HEALTHY_DIFF` constant in the `DataFeed.sol` contract is set to 3 days, which is used to validate the freshness of the exchange rate data from the Chainlink aggregator. During periods of high market volatility, a 3-day-old exchange rate may not accurately reflect the current market conditions, leading to potential inaccuracies in the minimum deposit amount calculations.

### Vulnerability Detail

The `minAmountToDepositInUsd()` function calculates the minimum deposit amount in USD by fetching the EUR/USD exchange rate:

```solidity
    function minAmountToDepositInUsd() public view returns (uint256) {
        return
            (minAmountToDepositInEuro * eurUsdDataFeed.getDataInBase18()) /
            10**18;
    }
```

The exchange rate is fetched from a Chainlink aggregator via the `getDataInBase18()` function, which ensures the returned data is no older than `_HEALTHY_DIFF` (3 days):

```solidity
        require(
            // solhint-disable-next-line not-rely-on-time
            block.timestamp - updatedAt <= _HEALTHY_DIFF,
            "DF: feed is unhealthy"
        );
```

### Impact

During periods of high market volatility, a 3-day-old exchange rate may not reflect the current market conditions accurately. This could lead to under- or overestimating the minimum deposit amount in USD.
Since `_HEALTHY_DIFF` is a constant, it cannot be adjusted dynamically to reflect changing market conditions:

```solidity
    uint256 private constant _HEALTHY_DIFF = 3 days;
```

### Code Snippet

https://github.com/sherlock-audit/2024-05-midas/blob/main/midas-contracts/contracts/DepositVault.sol#L137-L141

https://github.com/sherlock-audit/2024-05-midas/blob/main/midas-contracts/contracts/feeds/DataFeed.sol#L27

https://github.com/sherlock-audit/2024-05-midas/blob/main/midas-contracts/contracts/feeds/DataFeed.sol#L54-L80

### Tool used

Manual Review

### Recommendation

Introduce a setter function that allows the contract owner or an authorized role to update the `_HEALTHY_DIFF` value, which will ensure the data's freshness is appropriate for the current environment and market volatility.


## [M-02] Storage Gap Alignment in DepositVault and RedemptionVault Contracts

### Summary

The `DepositVault.sol` and `RedemptionVault.sol` contracts within the codebase exhibit a discrepancy in the size of their storage gaps. While `DepositVault` utilizes a storage gap of `uint256[50]`, `RedemptionVault` employs a storage gap of `uint256[51]`. This inconsistency deviates from the common practice observed in the codebase, where storage gaps typically align to a fixed number, often 50:

https://docs.openzeppelin.com/contracts/3.x/upgradeable

### Vulnerability Detail

The vulnerability arises from the mismatch in the size of the storage gaps between the two contracts. Inconsistencies in storage layout can lead to challenges in maintenance and future upgrades. While the difference between defined __gaps is 1 (51-1), mentioned contracts have more than 1 storage used in difference, i.e.

```solidity
// Example Contract A
uint256 private storageVariableA;
uint256[49] private __gap; // Should align with the number of storage variables used (1)

// Example Contract B
uint256 private storageVariableB1;
uint256 private storageVariableB2;
uint256 private storageVariableB3;
uint256[47] private __gap; // Should align with the number of storage variables used (3)
```

### Impact

The impact of this inconsistency lies in potential difficulties during code maintenance and upgrades. Inconsistent storage layouts can lead to storage collisions and make the codebase harder to understand and maintain.
The probability of something going wrong with future upgrades is low to medium, and the impact of mistakes would be medium to high.

### Code Snippet

https://github.com/sherlock-audit/2024-05-midas/blob/main/midas-contracts/contracts/DepositVault.sol#L60

https://github.com/sherlock-audit/2024-05-midas/blob/main/midas-contracts/contracts/RedemptionVault.sol#L40

### Tool used

Manual Review

### Recommendation

It is recommended to align the size of storage gaps in each contract with the number of storage variables used. This practice ensures consistency and mitigates the risk of storage collisions.
